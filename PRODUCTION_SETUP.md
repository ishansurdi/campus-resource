# Production Deployment Setup Guide

## üöÄ Quick Setup for Render Deployment

### Backend URL
`https://campus-resource-8pw5.onrender.com`

### Frontend URL
`https://campusphere-frontend-5sm4.onrender.com`

### Database
PostgreSQL Internal URL: `postgresql://campusphere_8xr1_user:BbwIKwZrx9okckpxMNPglmhnXQF6AWd1@dpg-d5v1ggili9vc739uiklg-a/campusphere_8xr1`

---

## üìã Initial Setup Steps

### 1. Create Admin User in Production Database

Since the production database doesn't have any users yet, you need to create the initial admin user:

**Method 1: Using Render Shell**
1. Go to your Render Dashboard
2. Navigate to `campus-resource` backend service
3. Click on "Shell" tab
4. Run the following commands:
```bash
cd backend
python create_production_admin.py
```

**Method 2: Using Django Management Command**
```bash
cd backend
python manage.py shell
```

Then run:
```python
from authentication.models import AdminUser

admin = AdminUser.objects.create_user(
    username='admin',
    email='admin@campusphere.edu',
    password='Admin@123',
    first_name='System',
    last_name='Administrator',
    role='admin',
    employee_id='EMP001',
    department='Information Technology',
    is_staff=True,
    is_superuser=True,
    is_active=True,
    two_factor_enabled=False
)
print("Admin user created successfully!")
```

### 2. Admin Login Credentials

After creating the admin user, use these credentials to login:

```
Username: admin
Password: Admin@123
Email: admin@campusphere.edu
Role: Administrator
```

**Login URL:** `https://campusphere-frontend-5sm4.onrender.com/login.html`

---

## üîß Environment Configuration

### Backend Environment Variables (Render)

Make sure these are set in your Render backend service:

```env
PYTHON_VERSION=3.11.0
DEBUG=false
DATABASE_URL=postgresql://campusphere_8xr1_user:BbwIKwZrx9okckpxMNPglmhnXQF6AWd1@dpg-d5v1ggili9vc739uiklg-a/campusphere_8xr1
SECRET_KEY=(auto-generated by Render)
ALLOWED_HOSTS=campus-resource-8pw5.onrender.com,.onrender.com,localhost,127.0.0.1
CORS_ALLOWED_ORIGINS=https://campusphere-frontend-5sm4.onrender.com,https://campus-resource-8pw5.onrender.com,http://localhost:3000,http://localhost:5500,http://127.0.0.1:5500
DJANGO_SETTINGS_MODULE=campusphere.settings
```

---

## üåê Testing the Deployment

### 1. Test Backend API

Open your browser and visit:
```
https://campus-resource-8pw5.onrender.com/api/auth/health/
```

You should see:
```json
{
  "status": "healthy",
  "database": "connected"
}
```

### 2. Test Login

1. Go to: `https://campusphere-frontend-5sm4.onrender.com/login.html`
2. Select role: **Admin**
3. Enter credentials:
   - Username: `admin`
   - Password: `Admin@123`
4. Click "Sign In to Portal"

---

## üîÑ Local Development Setup

### 1. Create `.env` file in backend folder

```bash
cd backend
cp .env.example .env
```

### 2. Update `.env` with your local settings

```env
# For local PostgreSQL
DB_NAME=campusphere_db
DB_USER=postgres
DB_PASSWORD=your_local_password
DB_HOST=localhost
DB_PORT=5432

# OR use the production database for testing
# DATABASE_URL=postgresql://campusphere_8xr1_user:BbwIKwZrx9okckpxMNPglmhnXQF6AWd1@dpg-d5v1ggili9vc739uiklg-a/campusphere_8xr1

SECRET_KEY=your-secret-key-for-local-dev
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://localhost:8000,http://localhost:5500
```

### 3. Run migrations

```powershell
cd backend
python manage.py migrate
```

### 4. Create local admin user

```powershell
python setup.py
```

### 5. Start backend server

```powershell
python manage.py runserver
```

### 6. Open frontend

Open `frontend/index.html` in your browser or use a local server:
```powershell
# Using Python
cd frontend
python -m http.server 5500
```

Then visit: `http://localhost:5500`

---

## üîê Security Notes

### Production
- Change the default admin password after first login
- Use strong passwords for all users
- Enable 2FA for admin accounts
- Regularly update dependencies

### Database
- The internal database URL is only accessible from within Render services
- External connections require the external URL (if configured)
- Regular backups are recommended

---

## üìä Monitoring

### Check Backend Logs
1. Go to Render Dashboard
2. Select `campus-resource` service
3. Click on "Logs" tab
4. Monitor for any errors

### Common Issues

**Issue: 401 Unauthorized**
- Cause: Admin user doesn't exist in database
- Fix: Run `create_production_admin.py` script

**Issue: CORS Error**
- Cause: Frontend URL not in CORS_ALLOWED_ORIGINS
- Fix: Update CORS_ALLOWED_ORIGINS environment variable in Render

**Issue: 500 Server Error**
- Cause: Database connection issue or missing migrations
- Fix: Check DATABASE_URL and run migrations

---

## üéØ Next Steps

1. ‚úÖ Create admin user in production database
2. ‚úÖ Test login with admin credentials
3. ‚úÖ Change default admin password
4. Create faculty users
5. Create student users
6. Configure university profile
7. Set up clubs and events

---

## üìû Support

For issues or questions:
- Check logs in Render Dashboard
- Review Django error messages
- Verify environment variables are set correctly
- Ensure database migrations are up to date

**Useful Commands:**
```bash
# Check migrations status
python manage.py showmigrations

# Run specific migration
python manage.py migrate authentication

# Create superuser (alternative method)
python manage.py createsuperuser

# Django shell for debugging
python manage.py shell
```
