<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | CAMPUSPHERE</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --stone-50: #faf9f6;
            --stone-100: #f1f0ec;
            --stone-200: #e5e3da;
            --charcoal: #1a1c1e;
            --muted-blue: #2d4a63;
            --accent-gold: #c5a059;
            --accent-teal: #3d706e;
        }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--stone-50);
            color: var(--charcoal);
        }
        h1, h2, h3 { font-family: 'Inter', sans-serif; letter-spacing: -0.02em; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--stone-50); }
        ::-webkit-scrollbar-thumb { background: var(--stone-200); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--muted-blue); }
        
        .modal-overlay { display: none; position: fixed; inset: 0; background-color: rgba(0,0,0,0.5); z-index: 60; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .club-card { cursor: pointer; transition: all 0.2s; }
        .club-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .club-card.selected { border-color: #2d4a63; background-color: #f1f0ec; }
    </style>
</head>
<body class="antialiased">

    <!-- Fixed Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-[#faf9f6]/90 backdrop-blur-xl border-b border-[#e5e3da]">
        <div class="max-w-7xl mx-auto px-8 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-[#1a1c1e] flex items-center justify-center rounded-sm">
                    <div class="w-4 h-4 border-2 border-[#c5a059] rotate-45"></div>
                </div>
                <a href="index.html" class="text-xl font-bold tracking-[0.2em] text-[#1a1c1e]">CAMPUSPHERE</a>
            </div>
            <div class="flex items-center gap-6">
                <a href="index.html" class="text-[12px] font-bold text-slate-500 hover:text-[#1a1c1e] transition-colors uppercase tracking-widest">Back to Home</a>
            </div>
        </div>
    </nav>

    <!-- Login Section -->
    <section class="min-h-screen pt-32 pb-20 px-8 flex items-center justify-center">
        <div class="max-w-6xl w-full grid lg:grid-cols-2 gap-16 items-center">
            
            <!-- Left Side - Branding -->
            <div class="hidden lg:block">
                <div id="badge" class="inline-flex items-center gap-2 px-4 py-1.5 rounded-sm bg-[#f1f0ec] border border-[#e5e3da] text-[10px] font-bold uppercase tracking-widest text-[#2d4a63] mb-8 shadow-sm">
                    <span class="relative flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[#2d4a63] opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-[#2d4a63]"></span>
                    </span>
                    <span id="badge-text">Portal Access</span>
                </div>
                <h1 class="text-5xl font-bold leading-[1.1] text-[#1a1c1e] mb-8">
                    <span id="heading-main">Secure Access to Your</span> <span id="heading-accent" class="italic font-serif text-[#2d4a63]">Institutional Portal.</span>
                </h1>
                <p id="description" class="text-lg text-slate-500 mb-10 leading-relaxed">
                    Access your personalized dashboard, track progress, and collaborate through our unified institutional platform.
                </p>
                <div class="flex items-center gap-8 border-t border-[#e5e3da] pt-8">
                    <div>
                        <div class="text-2xl font-bold text-[#1a1c1e]">24/7</div>
                        <div class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Access</div>
                    </div>
                    <div class="w-px h-8 bg-[#e5e3da]"></div>
                    <div>
                        <div class="text-2xl font-bold text-[#1a1c1e]">Secure</div>
                        <div class="text-[10px] font-bold uppercase tracking-widest text-slate-400">FERPA Compliant</div>
                    </div>
                </div>
            </div>

            <!-- Right Side - Login Form -->
            <div class="w-full">
                <div class="bg-white border border-[#e5e3da] rounded-xl shadow-2xl p-12">
                    <div class="mb-10">
                        <h2 id="form-title" class="text-3xl font-bold text-[#1a1c1e] mb-3">Portal Login</h2>
                        <p class="text-sm text-slate-500">Select your role and enter credentials</p>
                    </div>

                    <form id="login-form" class="space-y-6">
                        <!-- Error Message -->
                        <div id="error-message" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-sm text-sm">
                        </div>

                        <!-- Role Selector -->
                        <div>
                            <label class="block text-[11px] font-bold uppercase tracking-widest text-[#1a1c1e] mb-3">Select Role</label>
                            <select id="role-selector" class="w-full px-5 py-4 border border-[#e5e3da] rounded-sm text-[14px] focus:outline-none focus:border-[#2d4a63] focus:ring-2 focus:ring-[#2d4a63]/10 transition-all font-bold">
                                <option value="student">Student</option>
                                <option value="faculty">Faculty</option>
                                <option value="admin">Admin</option>
                                <option value="registrar">Registrar</option>
                            </select>
                        </div>

                        <!-- Club Selection (Only for Students & Faculty) -->
                        <div id="club-field" class="hidden">
                            <label class="block text-[11px] font-bold uppercase tracking-widest text-[#1a1c1e] mb-3">Club ID <span class="text-red-500">*</span></label>
                            <select id="club-input" class="w-full px-5 py-4 border border-[#e5e3da] rounded-sm text-[14px] focus:outline-none focus:border-[#2d4a63] focus:ring-2 focus:ring-[#2d4a63]/10 transition-all font-bold">
                                <option value="">Loading clubs...</option>
                            </select>
                            <p class="mt-2 text-xs text-slate-500">Select your club ID for this session</p>
                        </div>

                        <div id="username-field">
                            <label id="username-label" class="block text-[11px] font-bold uppercase tracking-widest text-[#1a1c1e] mb-3">Username or Email</label>
                            <input 
                                id="username-input"
                                type="text" 
                                placeholder="Enter your username or email"
                                class="w-full px-5 py-4 border border-[#e5e3da] rounded-sm text-[14px] focus:outline-none focus:border-[#2d4a63] focus:ring-2 focus:ring-[#2d4a63]/10 transition-all"
                                required
                            />
                        </div>

                        <div>
                            <label class="block text-[11px] font-bold uppercase tracking-widest text-[#1a1c1e] mb-3">Password</label>
                            <input 
                                id="password-input"
                                type="password" 
                                placeholder="Enter your password"
                                class="w-full px-5 py-4 border border-[#e5e3da] rounded-sm text-[14px] focus:outline-none focus:border-[#2d4a63] focus:ring-2 focus:ring-[#2d4a63]/10 transition-all"
                                required
                            />
                        </div>

                        <!-- Two-Factor (Only for Admin) -->
                        <div id="two-factor-field" class="hidden">
                            <label class="block text-[11px] font-bold uppercase tracking-widest text-[#1a1c1e] mb-3">Two-Factor Code</label>
                            <input 
                                id="two-factor-input"
                                type="text" 
                                placeholder="6-digit authentication code"
                                class="w-full px-5 py-4 border border-[#e5e3da] rounded-sm text-[14px] focus:outline-none focus:border-[#c5a059] focus:ring-2 focus:ring-[#c5a059]/10 transition-all"
                            />
                        </div>

                        <!-- Department (Only for Registrar) -->
                        <div id="department-field" class="hidden">
                            <label class="block text-[11px] font-bold uppercase tracking-widest text-[#1a1c1e] mb-3">Department Code</label>
                            <select id="department-input" class="w-full px-5 py-4 border border-[#e5e3da] rounded-sm text-[14px] focus:outline-none focus:border-slate-700 focus:ring-2 focus:ring-slate-700/10 transition-all">
                                <option>Select Department</option>
                                <option>Main Registrar Office</option>
                                <option>Admissions & Records</option>
                                <option>Academic Certification</option>
                                <option>Enrollment Services</option>
                            </select>
                        </div>

                        <div class="flex items-center justify-between text-sm">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" class="w-4 h-4 border-2 border-[#e5e3da] rounded">
                                <span class="text-[11px] font-bold uppercase tracking-widest text-slate-500">Remember me</span>
                            </label>
                            <a href="#" class="text-[11px] font-bold uppercase tracking-widest text-[#2d4a63] hover:text-[#1a1c1e] transition-colors">Forgot Password?</a>
                        </div>

                        <button 
                            id="submit-btn"
                            type="submit"
                            class="w-full bg-[#2d4a63] text-white px-10 py-5 rounded-sm font-bold text-[12px] uppercase tracking-[0.1em] hover:translate-y-[-2px] hover:bg-[#1a1c1e] transition-all shadow-xl"
                        >
                            Sign In to Portal
                        </button>
                    </form>

                    <div class="mt-8 pt-8 border-t border-[#f1f0ec]">
                        <p id="help-text" class="text-[11px] text-center text-slate-400 font-medium">
                            Need help? Contact <a href="#" class="text-[#2d4a63] font-bold hover:underline">Support Services</a>
                        </p>
                    </div>

                    <!-- Admin Notice -->
                    <div id="admin-notice" class="mt-8 pt-8 border-t border-[#f1f0ec] hidden">
                        <div class="flex items-center justify-center gap-2 text-[10px] font-bold uppercase tracking-widest text-slate-400">
                            <svg class="w-4 h-4 text-[#3d706e]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                            All Actions Logged & Audited
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white border-t border-[#e5e3da] py-8 px-8">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4 text-[9px] font-bold uppercase tracking-[0.3em] text-slate-400">
            <div class="flex items-center gap-4">
                <span>&copy; 2024 CAMPUSPHERE INFRASTRUCTURE.</span>
            </div>
            <div class="flex items-center gap-8">
                <a href="#" class="hover:text-[#1a1c1e]">PRIVACY</a>
                <a href="#" class="hover:text-[#1a1c1e]">SECURITY</a>
                <span class="text-[#3d706e]">SYSTEM: OPERATIONAL</span>
            </div>
        </div>
    </footer>

    <!-- Club Selection Modal -->
    <div id="clubSelectionModal" class="modal-overlay">
        <div class="bg-white rounded-sm p-8 max-w-2xl w-full mx-4 border border-[#e5e3da]">
            <h2 class="text-2xl font-bold text-[#1a1c1e] mb-2">Select Your Active Club</h2>
            <p class="text-sm text-slate-500 mb-6">Choose which club you want to work with in this session</p>
            
            <div id="clubsContainer" class="space-y-3 mb-6 max-h-96 overflow-y-auto">
                <!-- Clubs will be populated here -->
            </div>
            
            <button onclick="skipClubSelection()" class="w-full px-6 py-3 border border-[#e5e3da] text-[#1a1c1e] text-xs font-bold uppercase tracking-widest hover:bg-[#f1f0ec] transition-colors">
                Continue Without Selecting
            </button>
        </div>
    </div>

    <script>
        // Role configurations
        const roleConfig = {
            student: {
                badge: { text: 'Student Portal Access', color: '#2d4a63' },
                heading: { main: 'Welcome to Your', accent: 'Academic Gateway.', color: '#2d4a63' },
                description: 'Access course materials, track your academic progress, and collaborate with peers through our unified institutional platform.',
                formTitle: 'Student Login',
                usernameLabel: 'Username or Email',
                usernamePlaceholder: 'Enter your username or email',
                buttonText: 'Sign In to Portal',
                buttonColor: 'bg-[#2d4a63] hover:bg-[#1a1c1e]',
                helpLink: 'Student Services',
                showTwoFactor: false,
                showDepartment: false,
                showClubField: true,
                showAdminNotice: false
            },
            faculty: {
                badge: { text: 'Faculty Portal Access', color: '#3d706e' },
                heading: { main: 'Academic Excellence', accent: 'Starts Here.', color: '#3d706e' },
                description: 'Manage courses, grade submissions, communicate with students, and coordinate with departments through our comprehensive faculty platform.',
                formTitle: 'Faculty Login',
                usernameLabel: 'Faculty Email',
                usernamePlaceholder: 'faculty@institution.edu',
                buttonText: 'Sign In to Portal',
                buttonColor: 'bg-[#3d706e] hover:bg-[#2d4a63]',
                helpLink: 'IT Support',
                showTwoFactor: false,
                showDepartment: false,
                showClubField: true,
                showAdminNotice: false
            },
            admin: {
                badge: { text: 'Administrative Access', color: '#c5a059' },
                heading: { main: 'System Control', accent: '& Oversight.', color: '#c5a059' },
                description: 'Comprehensive administrative control for institutional management, policy enforcement, and system-wide configuration through a secure governance interface.',
                formTitle: 'Admin Login',
                usernameLabel: 'Admin Username',
                usernamePlaceholder: 'Enter admin username',
                buttonText: 'Authenticate & Enter',
                buttonColor: 'bg-[#c5a059] hover:bg-[#1a1c1e]',
                helpLink: 'Security Team',
                showTwoFactor: true,
                showDepartment: false,
                showClubField: false,
                showAdminNotice: true
            },
            registrar: {
                badge: { text: 'Registrar Portal Access', color: '#475569' },
                heading: { main: 'Academic Records', accent: 'Management.', color: '#475569' },
                description: 'Comprehensive student records, enrollment management, transcript processing, and academic compliance oversight through our institutional registrar system.',
                formTitle: 'Registrar Login',
                usernameLabel: 'Registrar ID',
                usernamePlaceholder: 'Enter registrar credentials',
                buttonText: 'Access Registrar System',
                buttonColor: 'bg-slate-700 hover:bg-[#1a1c1e]',
                helpLink: 'Registrar Support',
                showTwoFactor: false,
                showDepartment: true,
                showClubField: false,
                showAdminNotice: false
            }
        };

        // Get role from URL parameter or default to student
        const urlParams = new URLSearchParams(window.location.search);
        const initialRole = urlParams.get('role') || 'student';
        
        // Set initial role in selector
        document.getElementById('role-selector').value = initialRole;

        // Update UI based on role
        function updateUI(role) {
            const config = roleConfig[role];
            
            // Update badge
            document.getElementById('badge-text').textContent = config.badge.text;
            document.querySelector('#badge span:last-child').style.backgroundColor = config.badge.color;
            document.querySelector('#badge span:first-child span:last-child').style.backgroundColor = config.badge.color;
            
            // Update heading
            document.getElementById('heading-main').textContent = config.heading.main;
            document.getElementById('heading-accent').textContent = config.heading.accent;
            document.getElementById('heading-accent').style.color = config.heading.color;
            
            // Update description
            document.getElementById('description').textContent = config.description;
            
            // Update form title
            document.getElementById('form-title').textContent = config.formTitle;
            
            // Update username field
            document.getElementById('username-label').textContent = config.usernameLabel;
            document.getElementById('username-input').placeholder = config.usernamePlaceholder;
            
            // Update button
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.textContent = config.buttonText;
            submitBtn.className = 'w-full text-white px-10 py-5 rounded-sm font-bold text-[12px] uppercase tracking-[0.1em] hover:translate-y-[-2px] transition-all shadow-xl ' + config.buttonColor;
            
            // Update help text
            document.getElementById('help-text').innerHTML = `Need help? Contact <a href="#" class="font-bold hover:underline" style="color: ${config.heading.color}">${config.helpLink}</a>`;
            
            // Show/hide conditional fields
            document.getElementById('two-factor-field').classList.toggle('hidden', !config.showTwoFactor);
            document.getElementById('department-field').classList.toggle('hidden', !config.showDepartment);
            document.getElementById('club-field').classList.toggle('hidden', !config.showClubField);
            document.getElementById('admin-notice').classList.toggle('hidden', !config.showAdminNotice);
            
            // Toggle required attribute on club field based on visibility
            const clubInput = document.getElementById('club-input');
            if (config.showClubField) {
                clubInput.required = true;
            } else {
                clubInput.required = false;
            }
            
            // Load clubs if showing club field
            if (config.showClubField) {
                loadAvailableClubs();
            }
        }

        // Load available clubs from API
        async function loadAvailableClubs() {
            try {
                // Fetch clubs from public endpoint (no auth required)
                const response = await fetch('http://localhost:8000/api/auth/clubs/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const clubs = await response.json();
                    const clubSelect = document.getElementById('club-input');
                    clubSelect.innerHTML = '<option value="">Select Club ID</option>' +
                        clubs.map(club => {
                            // Show club_number (assigned during registration)
                            return `<option value="${club.id}" 
                                data-name="${club.name}" 
                                data-club-number="${club.club_number}"
                                data-email="${club.faculty_mentor_email || ''}">${club.club_number}</option>`;
                        }).join('');
                } else {
                    console.error('Failed to load clubs:', response.status);
                    const clubSelect = document.getElementById('club-input');
                    clubSelect.innerHTML = '<option value="">Failed to load clubs - Please restart server</option>';
                }
            } catch (error) {
                console.error('Error loading clubs:', error);
                const clubSelect = document.getElementById('club-input');
                clubSelect.innerHTML = '<option value="">Error - Please restart server</option>';
            }
        }

        // Update UI on page load
        updateUI(initialRole);

        // Update UI when role selector changes
        document.getElementById('role-selector').addEventListener('change', function(e) {
            updateUI(e.target.value);
        });

        // Handle form submission
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const role = document.getElementById('role-selector').value;
            const username = document.getElementById('username-input').value;
            const password = document.getElementById('password-input').value;
            const twoFactor = document.getElementById('two-factor-input')?.value || '';
            const errorDiv = document.getElementById('error-message');

            // Reset error message
            errorDiv.classList.add('hidden');
            errorDiv.textContent = '';

            // Disable submit button
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Signing in...';

            try {
                // Call login API
                const response = await fetch('http://localhost:8000/api/auth/login/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password,
                        role: role,
                        two_factor_code: twoFactor || null
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || data.error || 'Login failed. Please try again.');
                }

                // Store tokens in localStorage
                if (data.access && data.refresh) {
                    localStorage.setItem('access_token', data.access);
                    localStorage.setItem('refresh_token', data.refresh);
                    localStorage.setItem('user_role', role);
                    localStorage.setItem('user_id', data.user?.id || username);
                    
                    // Store complete user data
                    if (data.user) {
                        localStorage.setItem('user_data', JSON.stringify({
                            id: data.user.id,
                            username: data.user.username || username,
                            first_name: data.user.first_name || '',
                            last_name: data.user.last_name || '',
                            email: data.user.email || '',
                            role: role
                        }));
                    }

                    // If student, check if club was selected during login
                    if (role === 'student') {
                        const clubSelect = document.getElementById('club-input');
                        const selectedClubId = clubSelect?.value;
                        
                        if (!selectedClubId) {
                            throw new Error('Please select a club to continue');
                        }
                        
                        // Save club context from login form
                        const selectedOption = clubSelect.options[clubSelect.selectedIndex];
                        localStorage.setItem('active_club_id', selectedClubId);
                        localStorage.setItem('active_club_name', selectedOption.getAttribute('data-name') || selectedOption.text.split(' - ')[0]);
                        localStorage.setItem('active_club_email', selectedOption.getAttribute('data-email') || '');
                        localStorage.setItem('active_club_department', selectedOption.getAttribute('data-department') || '');
                        window.location.href = '/dashboards/student-dashboard/student-dashboard.html';
                    } else if (role === 'faculty') {
                        // For faculty, check if club was selected
                        const clubSelect = document.getElementById('club-input');
                        const selectedClubId = clubSelect?.value;
                        
                        if (!selectedClubId) {
                            throw new Error('Please select a club to continue');
                        }
                        
                        // Save club context from login form
                        const selectedOption = clubSelect.options[clubSelect.selectedIndex];
                        localStorage.setItem('active_club_id', selectedClubId);
                        localStorage.setItem('active_club_name', selectedOption.getAttribute('data-name') || selectedOption.text.split(' - ')[0]);
                        localStorage.setItem('active_club_email', selectedOption.getAttribute('data-email') || '');
                        localStorage.setItem('active_club_department', selectedOption.getAttribute('data-department') || '');
                        window.location.href = '/dashboards/faculty-dashboard/faculty-dashboard.html';
                    } else {
                        // Redirect based on role
                        const dashboards = {
                            admin: '/dashboards/admin-dashboard.html',
                            registrar: '/dashboards/registrar-dashboard.html'
                        };
                        window.location.href = dashboards[role] || '/dashboards/admin-dashboard.html';
                    }
                } else {
                    throw new Error('No authentication tokens received');
                }

            } catch (error) {
                errorDiv.classList.remove('hidden');
                errorDiv.textContent = error.message;
                submitBtn.disabled = false;
                submitBtn.textContent = roleConfig[role].buttonText;
            }
        });

        // Show club selection modal for students
        async function showClubSelectionModal(token) {
            try {
                // Fetch user's clubs
                const response = await fetch('http://localhost:8000/api/auth/my-clubs/', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const clubs = await response.json();
                    
                    if (clubs.length === 0) {
                        // No clubs, redirect to dashboard based on role
                        const userRole = localStorage.getItem('user_role');
                        const dashboards = {
                            student: '/dashboards/student-dashboard/student-dashboard.html',
                            faculty: '/dashboards/faculty-dashboard/faculty-dashboard.html'
                        };
                        window.location.href = dashboards[userRole] || '/dashboards/student-dashboard/student-dashboard.html';
                        return;
                    }

                    // Show modal with clubs
                    const modal = document.getElementById('clubSelectionModal');
                    const clubsContainer = document.getElementById('clubsContainer');
                    
                    clubsContainer.innerHTML = clubs.map(club => `
                        <div class="club-card p-4 border-2 border-[#e5e3da] rounded-sm" data-club-id="${club.club_id}" onclick="selectClub(${club.club_id}, '${club.club_name}', '${club.role}', '${club.department}')">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-[#1a1c1e]">${club.club_name}</h3>
                                ${club.status === 'approved' ? '<span class="text-xs font-bold text-green-600">✓ ACTIVE</span>' : '<span class="text-xs font-bold text-yellow-600">⏳ PENDING</span>'}
                            </div>
                            <p class="text-sm text-slate-500">Role: ${club.role}</p>
                            ${club.department ? `<p class="text-xs text-slate-400">Dept: ${club.department}</p>` : ''}
                        </div>
                    `).join('');
                    
                    modal.classList.add('active');
                } else {
                    // If error, redirect to dashboard based on role
                    const userRole = localStorage.getItem('user_role');
                    const dashboards = {
                        student: '/dashboards/student-dashboard/student-dashboard.html',
                        faculty: '/dashboards/faculty-dashboard/faculty-dashboard.html'
                    };
                    window.location.href = dashboards[userRole] || '/dashboards/student-dashboard/student-dashboard.html';
                }
            } catch (error) {
                console.error('Error fetching clubs:', error);
                const userRole = localStorage.getItem('user_role');
                const dashboards = {
                    student: '/dashboards/student-dashboard/student-dashboard.html',
                    faculty: '/dashboards/faculty-dashboard/faculty-dashboard.html'
                };
                window.location.href = dashboards[userRole] || '/dashboards/student-dashboard/student-dashboard.html';
            }
        }

        function selectClub(clubId, clubName, role, department) {
            // Store selected club in localStorage
            localStorage.setItem('active_club_id', clubId);
            localStorage.setItem('active_club_name', clubName);
            localStorage.setItem('active_club_role', role);
            if (department) {
                localStorage.setItem('active_club_department', department);
            }
            
            // Redirect to dashboard based on user role
            const userRole = localStorage.getItem('user_role');
            const dashboards = {
                student: '/dashboards/student-dashboard/student-dashboard.html',
                faculty: '/dashboards/faculty-dashboard/faculty-dashboard.html'
            };
            window.location.href = dashboards[userRole] || '/dashboards/student-dashboard/student-dashboard.html';
        }

        function skipClubSelection() {
            // Redirect without selecting a club based on user role
            const userRole = localStorage.getItem('user_role');
            const dashboards = {
                student: '/dashboards/student-dashboard/student-dashboard.html',
                faculty: '/dashboards/faculty-dashboard/faculty-dashboard.html'
            };
            window.location.href = dashboards[userRole] || '/dashboards/student-dashboard/student-dashboard.html';
        }
    </script>

</body>
</html>
